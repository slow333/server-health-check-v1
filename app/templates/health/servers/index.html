{% extends 'base.html' %}

{% block title %} Server Health Check {% endblock %}
{% block header %} Servers List
   {% if current_user.is_authenticated %}
   <span class="d-flex justify-content-end" style="margin-top:-30px">
     <a class="btn btn-outline-danger fs-sm" href="/health/servers/create">Create Server</a>
   </span>
  {% endif %}
{% endblock %}

{% block content %}
<div class="mt-3 d-flex justify-content-between align-items-center">
  <div>
    <a class="btn btn-outline-primary fs-sm" href="/health/hostinfos/generate">
      Generate HostInfos</a>
  </div>
  <form method="get" action="/health/servers/" accept-charset="utf-8" 
        class="d-flex justify-content-between align-items-center gap-1 fs-sm">
    <select name="user" id="" class="form-select d-inline-block w-auto  fs-sm">
      <option value="">Select User</option>
      {% for user in users %}
        <option value="{{ user.username }}" >{{ user.username }}</option>
      {% endfor %}
    </select>
    <input type="text" name="server_name" placeholder="Server Name" 
      value="{{ server_name }}" class="form-control d-inline-block fs-sm" style="width: 160px;">
    <input type="text" name="ip_address" placeholder="IP Address" 
      value="{{ ip_address }}" class="form-control d-inline-block fs-sm" style="width: 160px;">
    <button type="submit" class="btn btn-outline-secondary fs-sm">Search</button>
    <a class="btn btn-secondary fs-sm" href="/health/servers/">Reset</a>
  </form>
  </div>
  <table class="table table-striped mt-3 w-100 fs-sm">
      <thead class="thead-dark">
          <tr>
              <th>server name</th>
              <th>ID & IP</th>
              <th>Port</th>
              <th>PW</th>
              <th>Operators</th>
              <th>Created</th>
              <th>Hostname from hostinfos</th>
              <th>Edit</th>
              <th>Delete</th>
          </tr>
      </thead>
      <tbody>
        {% if current_user.is_admin %}
          {% for server in servers %}
            <tr>
              {% include 'health/servers/template_server_list.html' %}
            </tr>
          {% endfor %}
        {% else %}
          {% for server in server_list_by_user %}
            <tr>
              {% include 'health/servers/template_server_list.html' %}
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
{# pagenation: target_app, page, total_pages, per_page, page_length, start_page, end_page #}
  {% with 
    target_app='health/servers', 
    page=pagenation.page, 
    total_pages=pagenation.total_pages, 
    per_page=pagenation.per_page, 
    page_length=pagenation.page_len, 
    start_page=pagenation.start_page, 
    end_page=pagenation.end_page %}
      {% include 'pagenation.html' with context %}
  {% endwith %}
{% endblock %}